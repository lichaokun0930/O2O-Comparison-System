# 上传目录模式使用指南

## 🎯 功能简介

**全新的上传目录模式**：通过两个独立的上传目录明确区分本店和竞对，避免选错店铺的风险！

- 📂 `upload/本店/` - **本店数据上传入口**
- 📂 `upload/竞对/` - **竞对数据上传入口**

**🆕 智能模型选择器**：运行时可选择不同的AI模型进行比对
- 🤖 标准多语言模型（原模型）- 稳定可靠
- 🚀 BGE中文优化模型（推荐）- 准确率提升15-20%
- ⚡ M3E电商场景模型 - 针对电商优化

## 🚀 快速开始

### 超简单的三步操作：

1. **拖入本店文件** → 将本店Excel文件拖入 `upload/本店/` 目录
2. **拖入竞对文件** → 将竞对Excel文件拖入 `upload/竞对/` 目录  
3. **运行脚本** → 双击 `start_smart_comparison.ps1`
4. **选择模型** → 根据提示选择使用哪个AI模型（推荐选2-BGE模型）

```powershell
.\start_smart_comparison.ps1
```

就这么简单！系统会自动识别两个目录中的文件并进行比价分析。

## 📋 使用流程演示

## 📋 使用流程演示

### 第一步：准备文件目录

```
比价数据/
├── upload/
│   ├── 本店/
│   │   └── 徐州苏提路店.xlsx    ← 将本店文件拖到这里
│   └── 竞对/
│       └── 中解去化.xlsx        ← 将竞对文件拖到这里
└── start_smart_comparison.ps1
```

### 第二步：运行启动脚本

脚本会自动检测并显示：

```
📂 上传目录检查
============================================================
✅ 本店文件: 徐州苏提路店.xlsx (792.3KB, 2025-10-02 22:46)
✅ 竞对文件: 中解去化.xlsx (911.0KB, 2025-09-28 09:43)
============================================================

🎯 启动比价分析工具...
```

### 第三步：选择AI模型

首次运行或每次运行时，系统会提示您选择使用哪个AI模型：

```
==================================================================
🤖 嵌入模型选择
==================================================================
请选择用于商品比对的嵌入模型：

  [1] 标准多语言模型 (原模型)
      📝 说明: 通用多语言模型，成熟稳定
      📦 大小: ~420MB | ⚡ 速度: 正常 | 🎯 准确率: 良好

  [2] BGE中文优化模型 (推荐)
      📝 说明: 专为中文优化，准确率提升15-20%
      📦 大小: ~560MB | ⚡ 速度: 正常 | 🎯 准确率: 优秀

  [3] M3E电商场景模型
      📝 说明: 针对电商场景优化
      📦 大小: ~400MB | ⚡ 速度: 较快 | 🎯 准确率: 优秀

💡 提示:
   - 选项2 (BGE) 推荐用于中文商品，准确率最高
   - 选项1 (原模型) 稳定可靠，适合多语言场景
   - 首次使用新模型需要下载，约5-10分钟

请输入模型编号 (1-3, 回车=使用默认模型1): 2

✅ 已选择: BGE中文优化模型 (推荐)
   模型路径: BAAI/bge-base-zh-v1.5
   预期效果: 专为中文优化，准确率提升15-20%
==================================================================
```

### 第四步：自动分析

程序会显示：

```
📂 上传目录检测
============================================================
🏪 本店上传目录: upload/本店
🏬 竞对上传目录: upload/竞对

✅ 本店文件: 徐州苏提路店.xlsx (792.3KB, 2025-10-02 22:46)
✅ 竞对文件: 中解去化.xlsx (911.0KB, 2025-09-28 09:43)
============================================================

📝 已自动识别店铺名称:
  🏪 本店: 徐州苏提路店
  🏬 竞对: 中解去化
```

然后自动开始比价分析！

## 💡 智能特性

### 1. 多文件自动选择

如果某个目录中有多个Excel文件，系统会**自动选择最新的文件**：

```
📋 本店上传目录发现 3 个文件，使用最新文件: 徐州苏提路店_20251022.xlsx
   💡 提示: 其他文件将被忽略
      - 徐州苏提路店_20251021.xlsx (2025-10-21 15:30)
      - 徐州苏提路店_20251020.xlsx (2025-10-20 10:15)
```

### 2. 自动提取店铺名称

文件名会自动作为店铺名称：
- `徐州苏提路店.xlsx` → 店铺名称: `徐州苏提路店`
- `AA百货超市东站店.xlsx` → 店铺名称: `AA百货超市东站店`

### 3. 零配置运行

不需要修改任何代码，只需将文件放到对应目录即可！

## ⚙️ 配置选项

### 启用/禁用上传目录模式

在 `product_comparison_tool_local.py` 中的 `Config` 类：

```python
class Config:
    # 上传入口配置 - 通过不同目录区分本店和竞对
    UPLOAD_DIR_STORE_A = 'upload/本店'      # 本店数据上传目录
    UPLOAD_DIR_STORE_B = 'upload/竞对'      # 竞对数据上传目录
    USE_UPLOAD_DIRS = True                   # 启用上传目录模式
```

### 自定义上传目录路径

您可以修改上传目录的位置：

```python
class Config:
    UPLOAD_DIR_STORE_A = 'my_store/data'     # 自定义本店目录
    UPLOAD_DIR_STORE_B = 'competitor/data'   # 自定义竞对目录
```

### 传统配置模式

如果设置 `USE_UPLOAD_DIRS = False`，程序会使用传统的配置文件方式：

```python
class Config:
    USE_UPLOAD_DIRS = False  # 禁用上传目录模式
    STORE_A_FILENAME = '徐州苏提路店.xlsx'
    STORE_B_FILENAME = '中解去化.xlsx'
```

### 环境变量覆盖

您也可以通过环境变量直接指定文件路径（优先级最高）：

```powershell
$env:COMPARE_STORE_A_FILE = "D:\path\to\store_a.xlsx"
$env:COMPARE_STORE_B_FILE = "D:\path\to\store_b.xlsx"
python product_comparison_tool_local.py
```

## 🎨 优先级顺序

程序按以下优先级查找文件：

1. **环境变量** - `COMPARE_STORE_A_FILE` / `COMPARE_STORE_B_FILE` (最高优先级)
2. **上传目录** - `upload/本店/` 和 `upload/竞对/` (推荐方式)
3. **配置文件** - `Config` 类中的文件名设置 (传统方式)

## 💡 使用建议

### ✅ 推荐场景（上传目录模式）
- ✅ **避免选错店铺** - 通过独立目录明确区分本店和竞对
- ✅ **经常更换店铺** - 只需替换目录中的文件即可
- ✅ **多人协作** - 清晰的目录结构，不会搞混
- ✅ **零配置使用** - 不需要修改任何代码

### 适用于传统配置的场景
- 固定的店铺组合且不常变化
- 自动化脚本/批处理调用
- 文件路径由其他系统管理

## 🔧 常见问题

### Q: 上传目录在哪里？
A: 在比价数据目录下的 `upload/本店/` 和 `upload/竞对/`，首次运行脚本会自动创建

### Q: 可以同时放多个Excel文件吗？
A: 可以！系统会自动选择最新修改的文件，其他文件会被忽略

### Q: 找不到上传目录？
A: 运行一次 `start_smart_comparison.ps1`，脚本会自动创建这两个目录

### Q: 文件名会影响结果吗？
A: 文件名会作为店铺名称显示在报告中，建议使用有意义的名称如"徐州苏提路店.xlsx"

### Q: 如何确认系统识别了正确的文件？
A: 运行脚本后会显示详细的检测结果，包括文件名、大小和修改时间

### Q: 我放错目录了怎么办？
A: 只需将文件移动到正确的目录，重新运行脚本即可，不会有任何影响

### Q: 想使用传统配置方式？
A: 在 `Config` 类中设置 `USE_UPLOAD_DIRS = False` 即可

## 📊 示例工作流

```powershell
# 1. 准备文件（拖入对应目录）
#    upload/本店/徐州苏提路店.xlsx
#    upload/竞对/中解去化.xlsx

# 2. 启动比价
.\start_smart_comparison.ps1

# 输出示例：
# ============================================================
# ✅ 本店文件: 徐州苏提路店.xlsx (792.3KB, 2025-10-02 22:46)
# ✅ 竞对文件: 中解去化.xlsx (911.0KB, 2025-09-28 09:43)
# ============================================================
# 
# 📝 已自动识别店铺名称:
#   🏪 本店: 徐州苏提路店
#   🏬 竞对: 中解去化
#
# [开始比价分析...]

# 3. 等待分析完成
# 查看 reports/ 目录中的结果报告
```

## 🎓 技术细节

- **文件扫描**: 自动扫描 `.xlsx` 和 `.xls` 文件
- **文件信息**: 显示文件大小和修改时间
- **店铺名称**: 自动从文件名提取（去除扩展名，限制40字符）
- **错误处理**: 友好的错误提示和输入验证

---

**更新日期**: 2025年10月22日  
**版本**: v8.5+智能识别