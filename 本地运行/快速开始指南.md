# ðŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å— - æ–°åŠŸèƒ½ç‰ˆ v2.0

## ä¸€åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æ•°æ®
```
å°†æ•°æ®æ–‡ä»¶æ”¾å…¥ä»¥ä¸‹ç›®å½•ï¼š
â”œâ”€â”€ upload/
â”‚   â”œâ”€â”€ æœ¬åº—/          â† ä½ çš„é—¨åº—å•†å“æ•°æ® (Excel)
â”‚   â””â”€â”€ ç«žå¯¹/          â† ç«žäº‰å¯¹æ‰‹å•†å“æ•°æ® (Excel)
```

### ç¬¬äºŒæ­¥ï¼šè¿è¡Œè„šæœ¬
```powershell
.\start_smart_comparison.ps1
```

### ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹æŠ¥å‘Š
```
æ‰“å¼€ç”Ÿæˆçš„ Excel æ–‡ä»¶ï¼š
reports/matched_products_comparison_final_20250XXX_XXXXXX.xlsx
```

---

## ðŸ“Š æ–°ç‰ˆæœ¬ 9 ä¸ª Sheet è¯´æ˜Ž

| Sheetç¼–å· | åç§° | è¯´æ˜Ž | å…³é”®å­—æ®µ |
|----------|------|------|---------|
| **1** | æ¡ç ç²¾ç¡®åŒ¹é… | ä¸¤åº—æ¡ç å®Œå…¨ä¸€è‡´çš„å•†å“ | å•†å“åç§°ã€æ¡ç ã€ä»·æ ¼ã€åº“å­˜ |
| **2** | åç§°æ¨¡ç³ŠåŒ¹é… | é€šè¿‡AIè¯­ä¹‰åŒ¹é…çš„ç›¸ä¼¼å•†å“ | ç›¸ä¼¼åº¦è¯„åˆ†ã€ä»·æ ¼å·®å¼‚ |
| **3** | å·®å¼‚å“å¯¹æ¯” â­ | åŒç±»åˆ«ä½†æœ‰å·®å¼‚çš„å•†å“ | ä»·å·®%ã€ç›¸ä¼¼åº¦ã€å·®å¼‚åˆ†æž |
| **4** | Aåº—ç‹¬æœ‰(å…¨éƒ¨) | ä½ åº—æœ‰ä½†ç«žå¯¹æ— çš„æ‰€æœ‰SKU | å®Œæ•´å•†å“æ¸…å• |
| **5** | Båº—ç‹¬æœ‰(å…¨éƒ¨) | ç«žå¯¹æœ‰ä½†ä½ åº—æ— çš„æ‰€æœ‰SKU | å®Œæ•´å•†å“æ¸…å• |
| **6** | Aåº—ç‹¬æœ‰(åŽ»é‡) â­ | æŒ‰å•†å“ååŽ»é‡åŽçš„ç§ç±» | SKUæ•°é‡ã€åˆå¹¶æ¡ç  |
| **7** | Båº—ç‹¬æœ‰(åŽ»é‡) â­ | æŒ‰å•†å“ååŽ»é‡åŽçš„ç§ç±» | SKUæ•°é‡ã€åˆå¹¶æ¡ç  |
| **8** | å“ç±»ç¼ºå£åˆ†æž â­ | ä½ åº—ç¼ºå¤±çš„å“ç±»ç»„åˆ | ç¼ºå¤±å“ç±»ã€ä»£è¡¨å•†å“ |
| **9** | åº“å­˜>0&æŠ˜æ‰£ä¼˜åŠ¿ | åŒæ–¹æœ‰è´§ä¸”ä½ åº—æŠ˜æ‰£æ›´ä¼˜çš„å•†å“ | æŠ˜æ‰£å¯¹æ¯”ã€åº“å­˜ã€é”€é‡ |

â­ = v2.0 æ–°å¢žåŠŸèƒ½

---

## ðŸŽ¯ ä¸‰å¤§æ–°åŠŸèƒ½å¿«é€ŸæŸ¥çœ‹

### 1ï¸âƒ£ åŽ»é‡åŽçš„ç‹¬æœ‰å•†å“ (Sheet 6-7)

**ç”¨é€”**: å¿«é€Ÿäº†è§£ç‹¬æœ‰å•†å“çš„"ç§ç±»"è€Œéž"SKUæ•°"

**ç¤ºä¾‹**:
```
å•†å“åç§°           SKUæ•°é‡    æ¡ç                 åº“å­˜    æœˆå”®
å¯å£å¯ä¹ 330ml      3        1001|1002|1003      150    350
é›ªç¢§ 600ml          2        2001|2002           100    200
```

**è§£è¯»**: 
- å¯å£å¯ä¹æœ‰3ä¸ªä¸åŒæ¡ç (å¯èƒ½æ˜¯ä¸åŒæ‰¹æ¬¡/ä¾›åº”å•†)
- å®žé™…æ˜¯1ç§å•†å“ï¼Œä¸æ˜¯3ç§

---

### 2ï¸âƒ£ å·®å¼‚å“å¯¹æ¯” (Sheet 3)

**ç”¨é€”**: å‘çŽ°ç«žå¯¹çš„åŒç±»æ›¿ä»£å“å’Œå®šä»·ç­–ç•¥

**ç¤ºä¾‹**:
```
å•†å“A                å•†å“B                  ä»·å·®%    ç›¸ä¼¼åº¦    å·®å¼‚åˆ†æž
å†œå¤«å±±æ³‰ 550ml       æ€¡å® 550ml            +15%     0.42      åŒç±»å•†å“ï¼Œä»·æ ¼ç›¸è¿‘ï¼Œä½†å“ç‰Œä¸åŒ
é¦™é£˜é£˜å¥¶èŒ¶ åŽŸå‘³     ä¼˜ä¹ç¾Žå¥¶èŒ¶ ç»å…¸        -8%      0.48      åŒç±»å•†å“ï¼Œä»·æ ¼ç•¥ä½Žï¼Œå“ç‰Œæœ‰å·®å¼‚
```

**è§£è¯»**: 
- ä»·å·®åœ¨ Â±30% ä»¥å†…
- ç›¸ä¼¼åº¦ 0.3-0.55 (æœ‰å…³è”ä½†ä¸å®Œå…¨ç›¸åŒ)
- å¯ä½œä¸ºè¡¥å“æˆ–è°ƒä»·å‚è€ƒ

---

### 3ï¸âƒ£ å“ç±»ç¼ºå£åˆ†æž (Sheet 8)

**ç”¨é€”**: æˆ˜ç•¥è¡¥å“å»ºè®®ï¼Œæ‰¾å‡ºä½ åº—ç¼ºå¤±çš„å“ç±»

**ç¤ºä¾‹**:
```
ä¸€çº§åˆ†ç±»    ä¸‰çº§åˆ†ç±»      ç«žå¯¹å•†å“æ•°    ä»·æ ¼åŒºé—´      ä»£è¡¨å•†å“Top 3
é¥®æ–™       èŒ¶é¥®æ–™         12          3-8å…ƒ         åº·å¸ˆå‚…å†°çº¢èŒ¶(5.5å…ƒ/æœˆå”®300)
é›¶é£Ÿ       é¥¼å¹²           8           5-15å…ƒ        å¥¥åˆ©å¥¥(12å…ƒ/æœˆå”®250)
```

**è§£è¯»**: 
- ä½ åº—ç¼ºå¤±"é¥®æ–™>èŒ¶é¥®æ–™"è¿™ä¸ªå“ç±»
- ç«žå¯¹æœ‰12ä¸ªSKUåœ¨é”€å”®
- åº·å¸ˆå‚…å†°çº¢èŒ¶å–å¾—æœ€å¥½ï¼Œå¯ä¼˜å…ˆè€ƒè™‘è¡¥è´§

---

## ðŸŽ¨ ABAB åˆ—æŽ’åˆ—ä¼˜åŠ¿

### æ—§ç‰ˆæŽ’åˆ— (v1.x)
```
| å•†å“å_A | ä»·æ ¼_A | åº“å­˜_A | å•†å“å_B | ä»·æ ¼_B | åº“å­˜_B |
|---------|--------|--------|----------|--------|--------|
```
ðŸ‘€ è§†çº¿éœ€è¦å·¦å³å¤§å¹…åº¦ç§»åŠ¨

### æ–°ç‰ˆæŽ’åˆ— (v2.0)
```
| å•†å“å_A | å•†å“å_B | ä»·æ ¼_A | ä»·æ ¼_B | åº“å­˜_A | åº“å­˜_B |
|---------|----------|--------|--------|--------|--------|
```
ðŸ‘ åŒç±»ä¿¡æ¯ç›¸é‚»ï¼Œå¯¹æ¯”æ›´ç›´è§‚

**é€‚ç”¨èŒƒå›´**: 
- Sheet 1: æ¡ç ç²¾ç¡®åŒ¹é… âœ…
- Sheet 2: åç§°æ¨¡ç³ŠåŒ¹é… âœ…
- Sheet 3: å·®å¼‚å“å¯¹æ¯” âœ…
- Sheet 9: æŠ˜æ‰£ä¼˜åŠ¿å¯¹æ¯” âœ…

---

## âš™ï¸ å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: æ—¥å¸¸ä»·æ ¼æ¯”å¯¹
```powershell
# æ¯å‘¨ä¾‹è¡Œæ¯”ä»·
.\start_smart_comparison.ps1

# é‡ç‚¹æŸ¥çœ‹ï¼š
# - Sheet 1-2: åŒ¹é…å•†å“çš„ä»·æ ¼å·®å¼‚
# - Sheet 9: æˆ‘åº—æŠ˜æ‰£ä¼˜åŠ¿å•†å“
```

### åœºæ™¯2: æ–°å“è¡¥è´§å†³ç­–
```powershell
# æŸ¥çœ‹å“ç±»ç¼ºå£
.\start_smart_comparison.ps1

# é‡ç‚¹æŸ¥çœ‹ï¼š
# - Sheet 8: å“ç±»ç¼ºå£åˆ†æž (å“ªäº›å“ç±»éœ€è¦è¡¥)
# - Sheet 7: Båº—ç‹¬æœ‰(åŽ»é‡) (ç«žå¯¹å–ä»€ä¹ˆæˆ‘æ²¡æœ‰)
```

### åœºæ™¯3: ä¿ƒé”€ç­–ç•¥åˆ¶å®š
```powershell
# åˆ†æžå·®å¼‚å“å’Œä¼˜åŠ¿å•†å“
.\start_smart_comparison.ps1

# é‡ç‚¹æŸ¥çœ‹ï¼š
# - Sheet 3: å·®å¼‚å“å¯¹æ¯” (åŒç±»æ›¿ä»£å“å®šä»·)
# - Sheet 9: æŠ˜æ‰£ä¼˜åŠ¿ (å¯ä»¥é‡ç‚¹æŽ¨å¹¿çš„å•†å“)
```

### åœºæ™¯4: ç«žå¯¹åˆ†æž
```powershell
# å…¨é¢å¯¹æ¯”
.\start_smart_comparison.ps1

# æŸ¥çœ‹æ‰€æœ‰Sheetäº†è§£ï¼š
# - å“ªäº›å•†å“åŒ¹é… (Sheet 1-2)
# - å“ªäº›æ˜¯å·®å¼‚å“ (Sheet 3)
# - å„è‡ªçš„ç‹¬æœ‰å•†å“ (Sheet 4-7)
# - æˆ‘åº—ç¼ºå¤±çš„å“ç±» (Sheet 8)
```

---

## ðŸ”§ é«˜çº§é…ç½®

### è°ƒæ•´å·®å¼‚å“åŒ¹é…é˜ˆå€¼

ç¼–è¾‘ `product_comparison_tool_local.py`:
```python
# Line 1372 é™„è¿‘ï¼Œfind_differential_products() å‡½æ•°å†…
def find_differential_products(...):
    # ä»·æ ¼å®¹å·®ï¼šÂ±30% â†’ å¯æ”¹ä¸º Â±20% æˆ– Â±40%
    price_lower = df_a['å”®ä»·'] * 0.7  # æ”¹è¿™é‡Œ
    price_upper = df_a['å”®ä»·'] * 1.3  # æ”¹è¿™é‡Œ
    
    # ç›¸ä¼¼åº¦åŒºé—´ï¼š0.3-0.55 â†’ å¯æ”¹ä¸º 0.25-0.60
    sim_mask = (similarities >= 0.3) & (similarities <= 0.55)  # æ”¹è¿™é‡Œ
```

### è‡ªå®šä¹‰åŽ»é‡èšåˆæ–¹å¼

ç¼–è¾‘ `product_comparison_tool_local.py`:
```python
# Line 1341 é™„è¿‘ï¼Œdeduplicate_unique_products() å‡½æ•°å†…
agg_dict = {
    'æ¡ç ': lambda x: '|'.join(...),
    'åº“å­˜': 'sum',      # å¯æ”¹ä¸º 'max' (å–æœ€å¤§), 'mean' (å¹³å‡)
    'æœˆå”®': 'sum',      # å¯æ”¹ä¸º 'max', 'mean'
    'åŽŸä»·': 'first',    # å¯æ”¹ä¸º 'mean' (å¹³å‡ä»·), 'max' (æœ€é«˜ä»·)
}
```

---

## ðŸ› æ•…éšœæŽ’é™¤

### é—®é¢˜1: è„šæœ¬è¿è¡Œå¤±è´¥
```powershell
# æ£€æŸ¥è¯­æ³•
python -m py_compile product_comparison_tool_local.py

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
python product_comparison_tool_local.py
```

### é—®é¢˜2: ç›¸ä¼¼åº¦è®¡ç®—æ…¢
```powershell
# åˆ é™¤æ—§ç¼“å­˜é‡å»º
Remove-Item embedding_cache.joblib
.\start_smart_comparison.ps1
```

### é—®é¢˜3: CUDAé”™è¯¯
```powershell
# å¼ºåˆ¶ä½¿ç”¨CPUæ¨¡å¼
.\run_cpu_mode.ps1
```

### é—®é¢˜4: Sheetæ•°é‡ä¸å¯¹
- æ£€æŸ¥æ˜¯å¦æœ‰ç©ºæ•°æ®è¡¨ï¼ˆç©ºè¡¨ä¸ä¼šç”ŸæˆSheetï¼‰
- æŸ¥çœ‹æŽ§åˆ¶å°è¾“å‡ºçš„ç»Ÿè®¡ä¿¡æ¯

---

## ðŸ“ž æŠ€æœ¯æ”¯æŒ

### æ—¥å¿—ä½ç½®
```
logs/                    # ETLç®¡é“æ—¥å¿—
æŽ§åˆ¶å°è¾“å‡º               # å®žæ—¶è¿è¡Œä¿¡æ¯
```

### ç¼“å­˜æ–‡ä»¶
```
embedding_cache.joblib   # å‘é‡ç¼“å­˜ (å¯åˆ é™¤é‡å»º)
```

### é…ç½®æ–‡ä»¶
```
product_comparison_tool_local.py
â†“ æœç´¢ "class Config"
```

---

## ðŸ’¡ æœ€ä½³å®žè·µ

### âœ… æŽ¨èåšæ³•
1. **ä½¿ç”¨ä¸Šä¼ ç›®å½•æ¨¡å¼**: é¿å…æ‰‹åŠ¨ä¿®æ”¹é…ç½®
2. **å®šæœŸæ¸…ç†ç¼“å­˜**: å•†å“æ•°æ®å¤§å¹…å˜åŒ–æ—¶åˆ é™¤ç¼“å­˜
3. **æŒ‰åœºæ™¯æŸ¥çœ‹Sheet**: ä¸å¿…æ¯æ¬¡çœ‹å…¨éƒ¨9ä¸ªSheet
4. **ä¿å­˜åŽ†å²æŠ¥å‘Š**: ç”¨äºŽæ—¶é—´åºåˆ—åˆ†æž

### âŒ é¿å…
1. ä¸è¦åœ¨è„šæœ¬è¿è¡Œæ—¶å…³é—­ç»ˆç«¯çª—å£
2. ä¸è¦åŒæ—¶è¿è¡Œå¤šä¸ªæ¯”ä»·è„šæœ¬
3. ä¸è¦åœ¨ä½Žå†…å­˜çŽ¯å¢ƒå¤„ç†è¶…å¤§æ•°æ®é›†(10000+ SKU)
4. ä¸è¦æ‰‹åŠ¨ç¼–è¾‘ç”Ÿæˆçš„ExcelæŠ¥å‘ŠåŽå†ä½œä¸ºè¾“å…¥

---

## ðŸŽ“ ä¸‹ä¸€æ­¥å­¦ä¹ 

### æ·±å…¥äº†è§£
- ðŸ“– [æ–°åŠŸèƒ½å®žæ–½å®Œæˆæ€»ç»“.md](æ–°åŠŸèƒ½å®žæ–½å®Œæˆæ€»ç»“.md) - è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
- ðŸ“‹ [CHANGELOG.md](CHANGELOG.md) - ç‰ˆæœ¬æ›´æ–°æ—¥å¿—
- ðŸ“ [copilot-instructions.md](.github/copilot-instructions.md) - AIåŠ©æ‰‹æŒ‡å—

### æ‰©å±•åŠŸèƒ½
- ðŸ”§ é›†æˆETLç®¡é“: `run_price_panel_etl.py`
- ðŸ•·ï¸ æ•°æ®é‡‡é›†: `meituan_shop_goods_writer_breakpoint.py`
- ðŸ”„ æ–­ç‚¹ç»­çˆ¬: `test_breakpoint_resume.py`

---

**ç‰ˆæœ¬**: v2.0.0  
**æ›´æ–°æ—¥æœŸ**: 2025å¹´  
**ä½œè€…**: AI Assistant (GitHub Copilot)
